<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sopa de Letras ‚Äì Contusiones (Modo examen)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0f1118;
  --card:#181b29;
  --accent:#3cf2a4;
  --danger:#ff597a;
  --text:#f1f1f6;
  --muted:#9aa0b8;
  --border:rgba(255,255,255,0.2);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:
    radial-gradient(circle at top left, rgba(60,242,164,0.2), transparent 40%),
    radial-gradient(circle at bottom right, rgba(255,89,122,0.25), transparent 50%),
    var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}

.container{
  width:100%;
  max-width:1100px;
  background:linear-gradient(135deg, #121522, #090b12);
  border-radius:24px;
  padding:20px 24px 26px;
  border:1px solid var(--border);
  box-shadow:0 20px 45px rgba(0,0,0,0.6);
}

h1{
  margin:0;
  text-align:center;
  letter-spacing:0.08em;
  text-transform:uppercase;
  font-size:1.5rem;
}

.sub{
  text-align:center;
  margin:6px 0 20px;
  color:var(--muted);
  font-size:0.9rem;
}

/* INFO */
.info{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:15px;
}

.info div{
  background:#0e1018;
  padding:6px 12px;
  border-radius:999px;
  font-size:0.82rem;
  border:1px solid var(--border);
}

/* GAME GRID */
.game{
  display:grid;
  grid-template-columns: minmax(0,1.6fr) minmax(0,0.9fr);
  gap:20px;
  margin-top:10px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(14, 1fr);
  gap:4px;
  user-select:none;
  padding:10px;
  border-radius:16px;
  background:#111725;
  border:1px solid var(--border);
  cursor:crosshair;
}

.cell{
  aspect-ratio:1/1;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#151825;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.25);
  font-weight:600;
  cursor:inherit;
  transition:0.12s;
  font-size:0.9rem;
}

.cell:hover{ background:#22263a; }

.cell.selected{
  background:var(--accent);
  color:#08130e;
  font-weight:700;
}

.cell.found{
  background:#2d8c5e;
  color:white;
}

.cell.hint{
  box-shadow:0 0 10px rgba(255,217,90,0.9);
  border-color:#ffd95a;
}

/* WORD LIST */
.word-list{
  background:#10131e;
  border-radius:16px;
  padding:12px;
  border:1px solid var(--border);
}

.word-list h3{
  margin:0 0 6px;
  text-align:center;
  font-size:0.9rem;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:var(--accent);
}

.word-list ul{
  margin:0;
  padding:0;
  list-style:none;
  font-size:0.85rem;
}

.word-list li{
  margin:4px 0;
  padding:2px 6px;
  border-radius:6px;
}

.word-list li.found{
  text-decoration:line-through;
  color:var(--muted);
}

/* CONTROLES */
.controls{
  margin-top:18px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

button{
  padding:8px 16px;
  border-radius:999px;
  border:1px solid var(--border);
  background:linear-gradient(135deg,var(--accent),#25b97b);
  color:#08130e;
  font-weight:700;
  cursor:pointer;
  font-size:0.85rem;
}

button.secondary{
  background:transparent;
  color:var(--text);
}

button.danger{
  background:linear-gradient(135deg,#ff9b5a,#ff597a);
  color:#1a050a;
}

button:disabled{
  opacity:0.45;
  cursor:not-allowed;
  box-shadow:none;
}

button:hover:not(:disabled){
  box-shadow:0 0 15px rgba(60,242,164,0.5);
}

/* FINAL */
#final{
  display:none;
  margin-top:15px;
  padding:12px;
  border-radius:12px;
  background:#0f1420;
  border:1px solid var(--border);
  color:var(--muted);
  font-size:0.9rem;
}
#final strong.apto   { color:#3cf2a4; }
#final strong.noapto { color:#ff597a; }
</style>
</head>

<body>

<div class="container">
  <h1>Sopa de letras ‚Äì Contusiones</h1>
  <div class="sub">
    Modo examen ¬∑ Causa: ca√≠da y precipitaci√≥n (Medicina Legal) ¬∑ Tiempo l√≠mite: 3 minutos
  </div>

  <div class="info">
    <div>‚è± Tiempo restante: <span id="time">03:00</span></div>
    <div>‚úÖ Encontradas: <span id="score">0</span> / <span id="total"></span></div>
  </div>

  <div class="game">
    <div class="grid" id="grid"></div>

    <div class="word-list">
      <h3>Palabras (nivel dif√≠cil)</h3>
      <ul id="words"></ul>
    </div>
  </div>

  <div class="controls">
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button onclick="location.reload()">‚Ü∫ Reiniciar examen</button>
      <button id="hint-btn" class="danger">üí° Pista (-20 s)</button>
    </div>
    <button class="secondary"
      onclick="alert('Modo examen: dispones de 3 minutos para encontrar todas las palabras.\n\nSelecciona las letras manteniendo pulsado y arrastrando el rat√≥n (o el dedo en m√≥vil) sobre la palabra. \n\nEl bot√≥n PISTA resalta una palabra pendiente durante un instante, pero resta 20 segundos del tiempo restante. Al llegar a 0 se corrige el examen y se indica si el resultado es APTO (‚â•70% de aciertos) o NO APTO.')">
      ¬øC√≥mo se juega?
    </button>
  </div>

  <div id="final"></div>
</div>

<script>
// =================== CONFIGURACI√ìN ===================

// Palabras de nivel dif√≠cil
const wordList = [
 "CONTUSION",
 "CONTUSIONES",
 "CAIDA",
 "PRECIPITACION",
 "HEMATOMA",
 "EQUIMOSIS",
 "TRAUMATISMO",
 "FRACTURA",
 "EDEMA",
 "LUXACION",
 "LESION",
 "POLICONTUSION",
 "ESCORIACION",
 "ABRASION",
 "HEMORRAGICO"
];

document.getElementById("total").textContent = wordList.length;

// Tama√±o del tablero
const size = 14;

// Tiempo del examen (segundos)
const EXAM_TIME = 180;

// Penalizaci√≥n por pista (segundos)
const HINT_PENALTY = 20;

// =================== GENERACI√ìN DEL TABLERO ===================

let grid = Array.from({length:size}, ()=> Array(size).fill(""));
const directions = [
 {x:1,y:0},   // derecha
 {x:0,y:1},   // abajo
 {x:1,y:1},   // diagonal
 {x:-1,y:1}   // diagonal invertida
];

// Guardamos la posici√≥n de cada palabra para las pistas
const wordPositions = {}; // { PALABRA: [ {x,y}, ... ] }

function canPlace(word,x,y,dir){
 for(let i=0;i<word.length;i++){
   const nx=x+dir.x*i, ny=y+dir.y*i;
   if(nx<0||ny<0||nx>=size||ny>=size) return false;
   if(grid[ny][nx] && grid[ny][nx]!==word[i]) return false;
 }
 return true;
}

function place(word){
 let attempts = 0;
 while(attempts < 1500){
   attempts++;
   const dir = directions[Math.floor(Math.random()*directions.length)];
   const x = Math.floor(Math.random()*size);
   const y = Math.floor(Math.random()*size);

   if(canPlace(word,x,y,dir)){
     const coords = [];
     for(let i=0;i<word.length;i++){
       const nx = x + dir.x*i;
       const ny = y + dir.y*i;
       grid[ny][nx] = word[i];
       coords.push({x:nx,y:ny});
     }
     wordPositions[word] = coords;
     return;
   }
 }
 console.warn("No se ha podido colocar la palabra:", word);
}

// Colocamos las palabras
wordList.forEach(w=>place(w));

// Rellenamos huecos con letras aleatorias
for(let y=0;y<size;y++){
 for(let x=0;x<size;x++){
   if(!grid[y][x]){
     grid[y][x] = String.fromCharCode(65+Math.floor(Math.random()*26));
   }
 }
}

// Pintamos la cuadr√≠cula
const gridDiv = document.getElementById('grid');
const cells = []; // acceso r√°pido por √≠ndice
for (let y = 0; y < size; y++) {
  for (let x = 0; x < size; x++) {
    const d = document.createElement("div");
    d.className = "cell";
    d.textContent = grid[y][x];
    d.dataset.x = x;
    d.dataset.y = y;
    gridDiv.appendChild(d);
    cells.push(d);
  }
}

// Lista de palabras
const ul = document.getElementById("words");
wordList.forEach(w=>{
 const li=document.createElement("li");
 li.textContent=w;
 ul.appendChild(li);
});

// =================== L√ìGICA DEL JUEGO (SELECCI√ìN) ===================

let isDragging = false;
let selected = [];
let found = 0;
let gameOver = false;
const foundWords = new Set();

function clearSelection(){
  selected.forEach(c => c.classList.remove("selected"));
  selected = [];
}

function addToSelection(cell){
  if (selected.includes(cell) || cell.classList.contains("found")) return;
  cell.classList.add("selected");
  selected.push(cell);
}

// handlers de selecci√≥n
document.querySelectorAll(".cell").forEach(cell=>{
  // Inicio de arrastre
  cell.addEventListener("mousedown",(e)=>{
    if(gameOver) return;
    e.preventDefault();
    clearSelection();
    isDragging = true;
    addToSelection(cell);
  });

  cell.addEventListener("touchstart",(e)=>{
    if(gameOver) return;
    e.preventDefault();
    clearSelection();
    isDragging = true;
    addToSelection(cell);
  }, {passive:false});

  // Al pasar por encima mientras arrastras
  cell.addEventListener("mouseenter",()=>{
    if(!isDragging || gameOver) return;
    addToSelection(cell);
  });

  // Soporte t√°ctil: seguimos el dedo
  cell.addEventListener("touchmove",(e)=>{
    if(!isDragging || gameOver) return;
    const touch = e.touches[0];
    const el = document.elementFromPoint(touch.clientX, touch.clientY);
    if(el && el.classList.contains("cell")){
      addToSelection(el);
    }
  }, {passive:false});

  // click suelto: selecci√≥n corta
  cell.addEventListener("click",()=>{
    if(isDragging || gameOver) return;
    clearSelection();
    addToSelection(cell);
    checkWord();
  });
});

// Fin de arrastre
window.addEventListener("mouseup",()=>{
  if(!isDragging) return;
  isDragging = false;
  checkWord();
});

window.addEventListener("touchend",()=>{
  if(!isDragging) return;
  isDragging = false;
  checkWord();
});

// Comprobamos si lo seleccionado es una palabra
function checkWord(){
 if(gameOver) return;

 const word = selected.map(c=>c.textContent).join("");
 const index = wordList.indexOf(word);

 if(index !== -1){
   // marcar como encontrada
   selected.forEach(c=>{
     c.classList.remove("selected");
     c.classList.add("found");
   });
   document.querySelectorAll("#words li")[index].classList.add("found");
   found++;
   foundWords.add(wordList[index]);
   document.getElementById("score").textContent = found;

   if(found === wordList.length){
     endGame(false);
   }
 } else {
   // si no es palabra, limpiamos
   clearSelection();
 }

 selected = [];
}

// =================== CRONO CUENTA ATR√ÅS ===================

let remaining = EXAM_TIME;
let timerId = null;

function formatTime(s){
 const m = Math.floor(s/60);
 const sec = s % 60;
 return (m<10?"0"+m:m)+":"+(sec<10?"0"+sec:sec);
}

document.getElementById("time").textContent = formatTime(remaining);

timerId = setInterval(()=>{
 if(gameOver) return;
 remaining--;
 if(remaining < 0) remaining = 0;
 document.getElementById("time").textContent = formatTime(remaining);
 if(remaining === 0){
   endGame(true);
 }
},1000);

// =================== SISTEMA DE PISTAS ===================

const hintBtn = document.getElementById("hint-btn");

hintBtn.addEventListener("click", ()=>{
  if(gameOver) return;
  if(remaining <= 0) return;

  // Palabras que a√∫n faltan
  const pending = wordList.filter(w => !foundWords.has(w));
  if(pending.length === 0) return;

  // Penalizaci√≥n de tiempo
  remaining -= HINT_PENALTY;
  if(remaining < 0) remaining = 0;
  document.getElementById("time").textContent = formatTime(remaining);
  if(remaining === 0){
    endGame(true);
    return;
  }

  // Elegimos una palabra pendiente al azar
  const w = pending[Math.floor(Math.random()*pending.length)];
  const coords = wordPositions[w];
  if(!coords) return;

  // Resaltamos temporalmente sus letras
  const hintedCells = [];
  coords.forEach(pos=>{
    const index = pos.y * size + pos.x;
    const cell = cells[index];
    cell.classList.add("hint");
    hintedCells.push(cell);
  });

  setTimeout(()=>{
    hintedCells.forEach(c=>c.classList.remove("hint"));
  }, 1500);
});

// =================== FIN DEL EXAMEN ===================

function endGame(timeOver){
 if(gameOver) return;
 gameOver = true;
 clearInterval(timerId);
 hintBtn.disabled = true;

 const max = wordList.length;
 const ratio = found / max;
 const finalBox = document.getElementById("final");
 finalBox.style.display = "block";

 let valoracion, clase;
 if(ratio >= 0.7){
   valoracion = "APTO";
   clase = "apto";
 } else {
   valoracion = "NO APTO";
   clase = "noapto";
 }

 const motivo = timeOver
   ? "Fin del tiempo de examen."
   : "Has encontrado todas las palabras antes de agotar el tiempo.";

 finalBox.innerHTML =
   `<strong class="${clase}">${valoracion}</strong><br>` +
   `${motivo}<br>` +
   `Resultado: ${found} / ${max} palabras. (${Math.round(ratio*100)}% de aciertos).`;
}
</script>
</body>
</html>


