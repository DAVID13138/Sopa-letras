<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sopa de Letras – Contusiones, caídas y precipitación</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0f1118;
  --card:#181b29;
  --accent:#3cf2a4;
  --danger:#ff597a;
  --text:#f1f1f6;
  --muted:#9aa0b8;
  --border:rgba(255,255,255,0.2);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:
    radial-gradient(circle at top left, rgba(60,242,164,0.2), transparent 40%),
    radial-gradient(circle at bottom right, rgba(255,89,122,0.25), transparent 50%),
    var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}

.container{
  width:100%;
  max-width:1000px;
  background:linear-gradient(135deg, #121522, #090b12);
  border-radius:24px;
  padding:20px 24px 26px;
  border:1px solid var(--border);
  box-shadow:0 20px 45px rgba(0,0,0,0.6);
}

h1{
  margin:0;
  text-align:center;
  letter-spacing:0.08em;
  text-transform:uppercase;
  font-size:1.5rem;
}

.sub{
  text-align:center;
  margin:6px 0 20px;
  color:var(--muted);
  font-size:0.9rem;
}

/* INFO */
.info{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:15px;
}

.info div{
  background:#0e1018;
  padding:6px 12px;
  border-radius:999px;
  font-size:0.82rem;
  border:1px solid var(--border);
}

/* GAME GRID */
.game{
  display:grid;
  grid-template-columns: 1fr 260px;
  gap:20px;
  margin-top:15px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(14, 1fr);
  gap:4px;
  user-select:none;
  padding:10px;
  border-radius:16px;
  background:#111725;
  border:1px solid var(--border);
}

.cell{
  aspect-ratio:1/1;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#151825;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.25);
  font-weight:600;
  cursor:pointer;
  transition:0.15s;
  font-size:0.9rem;
}

.cell:hover{ background:#22263a; }

.cell.selected{
  background:var(--accent);
  color:#08130e;
  font-weight:700;
}

.cell.found{
  background:#2d8c5e;
  color:white;
}

/* WORD LIST */
.word-list{
  background:#10131e;
  border-radius:16px;
  padding:12px;
  border:1px solid var(--border);
}

.word-list h3{
  margin:0 0 6px;
  text-align:center;
  font-size:0.9rem;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:var(--accent);
}

.word-list ul{
  margin:0;
  padding:0;
  list-style:none;
  font-size:0.85rem;
}

.word-list li{
  margin:4px 0;
  padding:2px 6px;
  border-radius:6px;
}

.word-list li.found{
  text-decoration:line-through;
  color:var(--muted);
}

/* CONTROLES */
.controls{
  margin-top:20px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

button{
  padding:8px 16px;
  border-radius:999px;
  border:1px solid var(--border);
  background:linear-gradient(135deg,var(--accent),#25b97b);
  color:#08130e;
  font-weight:700;
  cursor:pointer;
}

button.secondary{
  background:transparent;
  color:var(--text);
}

button:hover{
  box-shadow:0 0 15px rgba(60,242,164,0.5);
}

/* FINAL */
#final{
  display:none;
  margin-top:15px;
  padding:12px;
  border-radius:12px;
  background:#0f1420;
  border:1px solid var(--border);
  color:var(--muted);
  font-size:0.9rem;
}
#final strong.apto   { color:#3cf2a4; }
#final strong.noapto { color:#ff597a; }
</style>
</head>

<body>

<div class="container">
  <h1>Sopa de letras – Contusiones</h1>
  <div class="sub">
    Modo examen · Causa: caída y precipitación (Medicina Legal) · Tiempo límite: 3 minutos
  </div>

  <div class="info">
    <div>⏱ Tiempo restante: <span id="time">03:00</span></div>
    <div>✅ Encontradas: <span id="score">0</span> / <span id="total"></span></div>
  </div>

  <div class="game">
    <div class="grid" id="grid"></div>

    <div class="word-list">
      <h3>Palabras</h3>
      <ul id="words"></ul>
    </div>
  </div>

  <div class="controls">
    <button onclick="location.reload()">↺ Reiniciar examen</button>
    <button class="secondary" onclick="alert('Modo examen: dispones de 3 minutos para encontrar todas las palabras relacionadas con las contusiones, caídas y la precipitación. Cada palabra encontrada se marca y se tacha en la lista. Al acabar el tiempo, se corrige automáticamente y se indica si el resultado es Apto o No apto.')">
      ¿Cómo se juega?
    </button>
  </div>

  <div id="final"></div>
</div>

<script>
// PALABRAS (nivel difícil)
const wordList = [
 "CONTUSION",
 "CONTUSIONES",
 "CAIDA",
 "PRECIPITACION",
 "HEMATOMA",
 "EQUIMOSIS",
 "TRAUMATISMO",
 "FRACTURA",
 "EDEMA",
 "LUXACION",
 "LESION",
 "POLICONTUSION",
 "ESCORIACION",
 "ABRASION",
 "HEMORRAGICO"
];

// Mostrar total en la cabecera
document.getElementById("total").textContent = wordList.length;

// Tamaño del tablero
const size = 14;
let grid = Array.from({length:size}, ()=> Array(size).fill(""));

// DIRECCIONES posibles
const directions = [
 {x:1,y:0},   // derecha
 {x:0,y:1},   // abajo
 {x:1,y:1},   // diagonal
 {x:-1,y:1}   // diagonal invertida
];

function place(word){
 let attempts = 0;
 let placed = false;

 while(!placed && attempts < 1500){
   attempts++;
   const dir = directions[Math.floor(Math.random()*directions.length)];
   const x = Math.floor(Math.random()*size);
   const y = Math.floor(Math.random()*size);

   if(canPlace(word,x,y,dir)){
     for(let i=0;i<word.length;i++){
       grid[y+dir.y*i][x+dir.x*i]=word[i];
     }
     placed=true;
   }
 }
}

function canPlace(word,x,y,dir){
 for(let i=0;i<word.length;i++){
   const nx=x+dir.x*i, ny=y+dir.y*i;
   if(nx<0||ny<0||nx>=size||ny>=size) return false;
   if(grid[ny][nx] && grid[ny][nx]!==word[i]) return false;
 }
 return true;
}

// Colocar todas las palabras
wordList.forEach(w=>place(w));

// Rellenar huecos
for(let y=0;y<size;y++){
 for(let x=0;x<size;x++){
   if(!grid[y][x]){
     grid[y][x] = String.fromCharCode(65+Math.floor(Math.random()*26));
   }
 }
}

// Pintar cuadrícula
const gridDiv = document.getElementById('grid');
for (let y = 0; y < size; y++) {
  for (let x = 0; x < size; x++) {
    const d = document.createElement("div");
    d.className = "cell";
    d.textContent = grid[y][x];
    gridDiv.appendChild(d);
  }
}

// Lista de palabras
const ul = document.getElementById("words");
wordList.forEach(w=>{
 const li=document.createElement("li");
 li.textContent=w;
 ul.appendChild(li);
});

// LÓGICA DE JUEGO
let selected=[];
let found=0;
let gameOver = false;

document.querySelectorAll(".cell").forEach(cell=>{
 cell.addEventListener("click",()=>{
   if(gameOver) return;
   if(cell.classList.contains("found")) return;
   cell.classList.toggle("selected");
   selected.push(cell);
   checkWord();
 });
});

function checkWord(){
 let word = selected.map(c=>c.textContent).join("");
 let index = wordList.indexOf(word);
 if(index!==-1){
   selected.forEach(c=>{
     c.classList.remove("selected");
     c.classList.add("found");
   });
   document.querySelectorAll("#words li")[index].classList.add("found");
   selected=[];
   found++;
   document.getElementById("score").textContent=found;
   if(found===wordList.length){
     endGame(false); // terminó encontrándolas todas
   }
 }
 if(selected.length>14) selected=[];
}

// CRONO CUENTA ATRÁS (3 minutos)
let remaining = 180; // segundos
let timerId = null;

function formatTime(s){
 const m = Math.floor(s/60);
 const sec = s % 60;
 return (m<10?"0"+m:m)+":"+(sec<10?"0"+sec:sec);
}

document.getElementById("time").textContent = formatTime(remaining);

timerId = setInterval(()=>{
 if(gameOver) return;
 remaining--;
 document.getElementById("time").textContent = formatTime(remaining);
 if(remaining<=0){
   remaining = 0;
   endGame(true); // tiempo agotado
 }
},1000);

// FIN DE EXAMEN
function endGame(timeOver){
 gameOver = true;
 clearInterval(timerId);

 const max = wordList.length;
 const ratio = found / max;
 const finalBox = document.getElementById("final");
 finalBox.style.display = "block";

 let valoracion, clase;
 if(ratio >= 0.7){
   valoracion = "APTO";
   clase = "apto";
 }else{
   valoracion = "NO APTO";
   clase = "noapto";
 }

 const motivo = timeOver
   ? "Fin del tiempo de examen."
   : "Has encontrado todas las palabras antes de agotar el tiempo.";

 finalBox.innerHTML =
   `<strong class="${clase}">${valoracion}</strong><br>` +
   `${motivo}<br>` +
   `Resultado: ${found} / ${max} palabras. (${Math.round(ratio*100)}% de aciertos).`;
}
</script>
</body>
</html>
